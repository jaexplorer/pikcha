{"ast":null,"code":"'use strict';\n\nvar objectAssign = require('object-assign');\n\nvar Emitter = require('tiny-emitter');\n\nvar Lethargy = require('lethargy').Lethargy;\n\nvar support = require('./support');\n\nvar clone = require('./clone');\n\nvar bindAll = require('bindall-standalone');\n\nvar EVT_ID = 'virtualscroll';\nmodule.exports = VirtualScroll;\nvar keyCodes = {\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n  SPACE: 32\n};\n\nfunction VirtualScroll(options) {\n  bindAll(this, '_onWheel', '_onMouseWheel', '_onTouchStart', '_onTouchMove', '_onKeyDown');\n  this.el = window;\n\n  if (options && options.el) {\n    this.el = options.el;\n    delete options.el;\n  }\n\n  this.options = objectAssign({\n    mouseMultiplier: 1,\n    touchMultiplier: 2,\n    firefoxMultiplier: 15,\n    keyStep: 120,\n    preventTouch: false,\n    unpreventTouchClass: 'vs-touchmove-allowed',\n    limitInertia: false,\n    useKeyboard: true,\n    useTouch: true\n  }, options);\n  if (this.options.limitInertia) this._lethargy = new Lethargy();\n  this._emitter = new Emitter();\n  this._event = {\n    y: 0,\n    x: 0,\n    deltaX: 0,\n    deltaY: 0\n  };\n  this.touchStartX = null;\n  this.touchStartY = null;\n  this.bodyTouchAction = null;\n\n  if (this.options.passive !== undefined) {\n    this.listenerOptions = {\n      passive: this.options.passive\n    };\n  }\n}\n\nVirtualScroll.prototype._notify = function (e) {\n  var evt = this._event;\n  evt.x += evt.deltaX;\n  evt.y += evt.deltaY;\n\n  this._emitter.emit(EVT_ID, {\n    x: evt.x,\n    y: evt.y,\n    deltaX: evt.deltaX,\n    deltaY: evt.deltaY,\n    originalEvent: e\n  });\n};\n\nVirtualScroll.prototype._onWheel = function (e) {\n  var options = this.options;\n  if (this._lethargy && this._lethargy.check(e) === false) return;\n  var evt = this._event; // In Chrome and in Firefox (at least the new one)\n\n  evt.deltaX = e.wheelDeltaX || e.deltaX * -1;\n  evt.deltaY = e.wheelDeltaY || e.deltaY * -1; // for our purpose deltamode = 1 means user is on a wheel mouse, not touch pad\n  // real meaning: https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent#Delta_modes\n\n  if (support.isFirefox && e.deltaMode == 1) {\n    evt.deltaX *= options.firefoxMultiplier;\n    evt.deltaY *= options.firefoxMultiplier;\n  }\n\n  evt.deltaX *= options.mouseMultiplier;\n  evt.deltaY *= options.mouseMultiplier;\n\n  this._notify(e);\n};\n\nVirtualScroll.prototype._onMouseWheel = function (e) {\n  if (this.options.limitInertia && this._lethargy.check(e) === false) return;\n  var evt = this._event; // In Safari, IE and in Chrome if 'wheel' isn't defined\n\n  evt.deltaX = e.wheelDeltaX ? e.wheelDeltaX : 0;\n  evt.deltaY = e.wheelDeltaY ? e.wheelDeltaY : e.wheelDelta;\n\n  this._notify(e);\n};\n\nVirtualScroll.prototype._onTouchStart = function (e) {\n  var t = e.targetTouches ? e.targetTouches[0] : e;\n  this.touchStartX = t.pageX;\n  this.touchStartY = t.pageY;\n};\n\nVirtualScroll.prototype._onTouchMove = function (e) {\n  var options = this.options;\n\n  if (options.preventTouch && !e.target.classList.contains(options.unpreventTouchClass)) {\n    e.preventDefault();\n  }\n\n  var evt = this._event;\n  var t = e.targetTouches ? e.targetTouches[0] : e;\n  evt.deltaX = (t.pageX - this.touchStartX) * options.touchMultiplier;\n  evt.deltaY = (t.pageY - this.touchStartY) * options.touchMultiplier;\n  this.touchStartX = t.pageX;\n  this.touchStartY = t.pageY;\n\n  this._notify(e);\n};\n\nVirtualScroll.prototype._onKeyDown = function (e) {\n  var evt = this._event;\n  evt.deltaX = evt.deltaY = 0;\n  var windowHeight = window.innerHeight - 40;\n\n  switch (e.keyCode) {\n    case keyCodes.LEFT:\n    case keyCodes.UP:\n      evt.deltaY = this.options.keyStep;\n      break;\n\n    case keyCodes.RIGHT:\n    case keyCodes.DOWN:\n      evt.deltaY = -this.options.keyStep;\n      break;\n\n    case keyCodes.SPACE && e.shiftKey:\n      evt.deltaY = windowHeight;\n      break;\n\n    case keyCodes.SPACE:\n      evt.deltaY = -windowHeight;\n      break;\n\n    default:\n      return;\n  }\n\n  this._notify(e);\n};\n\nVirtualScroll.prototype._bind = function () {\n  if (support.hasWheelEvent) this.el.addEventListener('wheel', this._onWheel, this.listenerOptions);\n  if (support.hasMouseWheelEvent) this.el.addEventListener('mousewheel', this._onMouseWheel, this.listenerOptions);\n\n  if (support.hasTouch && this.options.useTouch) {\n    this.el.addEventListener('touchstart', this._onTouchStart, this.listenerOptions);\n    this.el.addEventListener('touchmove', this._onTouchMove, this.listenerOptions);\n  }\n\n  if (support.hasPointer && support.hasTouchWin) {\n    this.bodyTouchAction = document.body.style.msTouchAction;\n    document.body.style.msTouchAction = 'none';\n    this.el.addEventListener('MSPointerDown', this._onTouchStart, true);\n    this.el.addEventListener('MSPointerMove', this._onTouchMove, true);\n  }\n\n  if (support.hasKeyDown && this.options.useKeyboard) document.addEventListener('keydown', this._onKeyDown);\n};\n\nVirtualScroll.prototype._unbind = function () {\n  if (support.hasWheelEvent) this.el.removeEventListener('wheel', this._onWheel);\n  if (support.hasMouseWheelEvent) this.el.removeEventListener('mousewheel', this._onMouseWheel);\n\n  if (support.hasTouch) {\n    this.el.removeEventListener('touchstart', this._onTouchStart);\n    this.el.removeEventListener('touchmove', this._onTouchMove);\n  }\n\n  if (support.hasPointer && support.hasTouchWin) {\n    document.body.style.msTouchAction = this.bodyTouchAction;\n    this.el.removeEventListener('MSPointerDown', this._onTouchStart, true);\n    this.el.removeEventListener('MSPointerMove', this._onTouchMove, true);\n  }\n\n  if (support.hasKeyDown && this.options.useKeyboard) document.removeEventListener('keydown', this._onKeyDown);\n};\n\nVirtualScroll.prototype.on = function (cb, ctx) {\n  this._emitter.on(EVT_ID, cb, ctx);\n\n  var events = this._emitter.e;\n  if (events && events[EVT_ID] && events[EVT_ID].length === 1) this._bind();\n};\n\nVirtualScroll.prototype.off = function (cb, ctx) {\n  this._emitter.off(EVT_ID, cb, ctx);\n\n  var events = this._emitter.e;\n  if (!events[EVT_ID] || events[EVT_ID].length <= 0) this._unbind();\n};\n\nVirtualScroll.prototype.reset = function () {\n  var evt = this._event;\n  evt.x = 0;\n  evt.y = 0;\n};\n\nVirtualScroll.prototype.destroy = function () {\n  this._emitter.off();\n\n  this._unbind();\n};","map":null,"metadata":{},"sourceType":"script"}